<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Local resolver &mdash; Whalebone 3.2.1-12 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Resolver management" href="resolvers.html" />
    <link rel="prev" title="Quickstart" href="quickstart.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html">
            
              <img src="_static/whalebone.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Deployment Options</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="deployment_peacemaker.html">Whalebone Peacemaker</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment%20immunity.html">Whalebone Immunity</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment_cloud.html">Cloud deployment</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quickstart</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Configuration</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Local resolver</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#local-resolver-system-requirements">Local resolver system requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation-of-a-new-local-resolver">Installation of a new local resolver</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#verifying-the-installation">Verifying the installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#securing-your-resolver">Securing your resolver</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="resolvers.html">Resolver management</a></li>
<li class="toctree-l1"><a class="reference internal" href="security_policies.html">Security policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="dns_resolution.html">DNS resolution configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="knot_tips_tricks.html">Knot Resolver - Tips &amp; Tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="blocking_pages.html">Blocking Pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="resolver_agent.html">Resolver agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="cloud_resolver.html">Cloud DNS resolvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="uninstalling.html">Uninstalling a local resolver</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Analysis and reporting</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="data_analysis.html">Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="domain_resolution_analysis.html">Domain resolution analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="reporting.html">Reports</a></li>
<li class="toctree-l1"><a class="reference internal" href="reporting.html#alerts">Alerts</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_integration.html">API Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="active_directory.html">Active Directory Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="snmp_monitoring.html">SNMP Monitoring</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Organization Settings</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="user.html">User/Organization Management</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Home Office Security</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="hos_overview.html">Home Office Security Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="hos_installation.html">Step by step installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="hos_operation.html">Operation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Step-by-Step Video Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="video_guides.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="video_guides.html#configuration">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="video_guides.html#analysis">Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="licence_disclaimer.html">License Disclaimers</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Whalebone</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Local resolver</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/local_resolver.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="local-resolver">
<h1>Local resolver<a class="headerlink" href="#local-resolver" title="Permalink to this heading"></a></h1>
<p>Deploying the Whalebone solution deployed as a <strong>local resolver</strong> brings the advantage of visibility of local IP addresses that send the actual requests. If deploying locally is not a suitable option for you,
check out the other <a class="reference internal" href="deployment.html#deployment-options"><span class="std std-ref">Deployment Options.</span></a></p>
<p>Whalebone resolver is based on the implementation of <a class="reference external" href="https://www.knot-resolver.cz/">Knot Resolver</a> developed in the CZ.NIC labs.</p>
<div class="section" id="local-resolver-system-requirements">
<h2>Local resolver system requirements<a class="headerlink" href="#local-resolver-system-requirements" title="Permalink to this heading"></a></h2>
<p>Local resolver is supported on dedicated (hardware or virtual) machine running a supported operating system.</p>
<ul class="simple">
<li><p><strong>Supported operating system</strong> (64-bit, server editions of following distributions):</p>
<ul>
<li><p>Red Hat Enterprise Linux 7, 8, 9</p></li>
<li><p>CentOS Linux 7, 8</p></li>
<li><p>CentOS Stream 8, 9</p></li>
<li><p>Debian 9, 10, 11, 12</p></li>
<li><p>Ubuntu 16.04, 18.04, 20.04, 22.04</p></li>
</ul>
</li>
<li><p><strong>Supported filesystems</strong></p>
<ul>
<li><p>ext4</p></li>
<li><p>xfs only with d_type support (ftype=1)</p></li>
</ul>
</li>
<li><p><strong>Minimum hardware sizing</strong> (physical or virtual):</p>
<ul>
<li><p>2 CPU cores</p></li>
<li><p>4 GB RAM</p></li>
<li><p>40 GB HDD (at least 30 GB in /var partition)</p></li>
</ul>
</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Please note that Whalebone only supports deloyments without desktop environments such as GNOME, KDE or Xfce as those can impact available memory and DNS processing on the server.</p>
</div>
<ul>
<li><p><strong>Network setup requirements</strong> (local resolver needs the following egress ports opened):</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 9%" />
<col style="width: 32%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Direction</p></th>
<th class="head"><p>Protocol(s)</p></th>
<th class="head"><p>Port</p></th>
<th class="head"><p>Destination IP/Domain</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Outbound</p></td>
<td><p>TCP+UDP</p></td>
<td><p>53</p></td>
<td><p>Any</p></td>
<td><p>DNS resolution</p></td>
</tr>
<tr class="row-odd"><td><p>Outbound</p></td>
<td><p>TCP</p></td>
<td><p>443</p></td>
<td><p>resolverapi.whalebone.io</p></td>
<td><p>Threat Database updates</p></td>
</tr>
<tr class="row-even"><td><p>Outbound</p></td>
<td><p>TCP</p></td>
<td><p>443</p></td>
<td><p>stream.whalebone.io</p></td>
<td><p>Threat Database updates</p></td>
</tr>
<tr class="row-odd"><td><p>Outbound</p></td>
<td><p>TCP</p></td>
<td><p>443</p></td>
<td><p>logger.whalebone.io</p></td>
<td><p>Logging stream</p></td>
</tr>
<tr class="row-even"><td><p>Outbound</p></td>
<td><p>TCP</p></td>
<td><p>443</p></td>
<td><p>agentapi.whalebone.io</p></td>
<td><p>Resolver management</p></td>
</tr>
<tr class="row-odd"><td><p>Outbound</p></td>
<td><p>TCP</p></td>
<td><p>443</p></td>
<td><p>transfer.whalebone.io</p></td>
<td><p>Support Log collection</p></td>
</tr>
<tr class="row-even"><td><p>Outbound</p></td>
<td><p>TCP</p></td>
<td><p>443</p></td>
<td><p>portal.whalebone.io</p></td>
<td><p>Admin portal</p></td>
</tr>
<tr class="row-odd"><td><p>Outbound</p></td>
<td><p>TCP</p></td>
<td><p>443</p></td>
<td><p>harbor.whalebone.io</p></td>
<td><p>Resolver updates</p></td>
</tr>
<tr class="row-even"><td><p>Outbound</p></td>
<td><p>TCP</p></td>
<td><p>443</p></td>
<td><p>download.docker.com</p></td>
<td><p>Installation Process</p></td>
</tr>
<tr class="row-odd"><td><p>Outbound</p></td>
<td><p>TCP</p></td>
<td><p>443</p></td>
<td><p>data.iana.org</p></td>
<td><p>DNSSEC keys</p></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Without communication on port 443 to the domains listed above the resolver won’t be installed at all (the installation script will abort).</p>
</div>
<p>The main function of the resolver to get queries from the customers and answer back to them the answer requires certain ports to be opened on the resolver for the traffic originating from the client subnet or coming to the customer interface.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 11%" />
<col style="width: 9%" />
<col style="width: 34%" />
<col style="width: 31%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Direction</p></th>
<th class="head"><p>Protocol</p></th>
<th class="head"><p>Port</p></th>
<th class="head"><p>Source IP/Domain</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Inbound</p></td>
<td><p>TCP+UDP</p></td>
<td><p>53</p></td>
<td><p>Customer’s subnet range(s)</p></td>
<td><p>DNS</p></td>
</tr>
<tr class="row-odd"><td><p>Inbound</p></td>
<td><p>TCP</p></td>
<td><p>853</p></td>
<td><p>Customer’s subnet range(s)</p></td>
<td><p>DNS over TLS (if used)</p></td>
</tr>
<tr class="row-even"><td><p>Inbound</p></td>
<td><p>TCP</p></td>
<td><p>443</p></td>
<td><p>Customer’s subnet range(s)</p></td>
<td><p>DNS over HTTPS (if used)</p></td>
</tr>
</tbody>
</table>
<p>The Blocking Pages are being hosted <strong>directly</strong> on the Resolvers so the IP addresses that are advertised to the clients must be used. The clients will then be redirected to the IP address of the resolver upon blocking. It is advised to allow only subnet(s) assigned to customers or trusted networks, otherwise it can be misused for various attacks or unauthorized users.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 11%" />
<col style="width: 9%" />
<col style="width: 34%" />
<col style="width: 31%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Direction</p></th>
<th class="head"><p>Protocol</p></th>
<th class="head"><p>Port</p></th>
<th class="head"><p>Source IP/Domain</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Inbound</p></td>
<td><p>TCP</p></td>
<td><p>80</p></td>
<td><p>Customer’s subnet range(s)</p></td>
<td><p>Redirection/Blocking page</p></td>
</tr>
<tr class="row-odd"><td><p>Inbound</p></td>
<td><p>TCP</p></td>
<td><p>443</p></td>
<td><p>Customer’s subnet range(s)</p></td>
<td><p>Redirection/Blocking page</p></td>
</tr>
</tbody>
</table>
<p>The resolver’s processes need to communicate on localhost. In case some firewall is in place please make sure that the traffic is allowed, i.e. <code class="docutils literal notranslate"><span class="pre">iptables</span> <span class="pre">-A</span> <span class="pre">INPUT</span> <span class="pre">-s</span> <span class="pre">127.0.0.1</span> <span class="pre">-j</span> <span class="pre">ACCEPT</span></code></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 10%" />
<col style="width: 8%" />
<col style="width: 30%" />
<col style="width: 39%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Direction</p></th>
<th class="head"><p>Protocol</p></th>
<th class="head"><p>Port</p></th>
<th class="head"><p>Source IP/Domain</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Inbound</p></td>
<td><p>TCP</p></td>
<td><p>ANY</p></td>
<td><p>127.0.0.1</p></td>
<td><p>Resolver’s processes communication</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For hardware sizing estimation of large ISP or Enterprise networks feel free to contact Whalebone. Whalebone local resolver will need approx. twice the RAM and CPU than usual resolver (BIND, Unbound).</p>
</div>
</div>
<div class="section" id="installation-of-a-new-local-resolver">
<h2>Installation of a new local resolver<a class="headerlink" href="#installation-of-a-new-local-resolver" title="Permalink to this heading"></a></h2>
<p>You can watch step-by-step video guide about the installation procedure <a class="reference internal" href="video_guides.html#deployment"><span class="std std-ref">here.</span></a></p>
<p>In menu <strong>Resolvers</strong> press the button <strong>Create new</strong>. Choose a name (identifier) for your new resolver. The input is purely informative and won’t affect the functionality.
Once you’ve entered the name, click <strong>Add resolver</strong> button.
After clicking the button an informative window will pop up with list of supported platforms and the one-line command for the installation. Copy the command and run on the machine dedicated for the local resolver.
The command will run the installation script and will pass the one time token used for the resolver activation (the same command can’t be used repeatedly).</p>
<img alt="_images/lrv2-create.gif" class="align-center" src="_images/lrv2-create.gif" />
<p>Once the command is run the operating system is being checked and requirements installed. Script will inform you about the progress and it creates a detailed log named <code class="docutils literal notranslate"><span class="pre">wb_install.log</span></code> in current directory.
Successful run of the installation script is ended with the notification <code class="docutils literal notranslate"><span class="pre">`Final</span> <span class="pre">tuning</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">OS`</span></code> with value <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">OK</span> <span class="pre">]</span></code>. Right after the installation also the initialization takes place and it could take several minutes before the resolver starts the services.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Local resolver is configured as an open resolver. It will respond to any request sent. This is quite comfortable in terms of availability of the services, but also could be a risk if the service is available from the outside networks. Please make sure you limit the access to the local resolver on port 53 (UDP and TCP) from the trusted networks only, otherwise it can be misused for various DoS attacks.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The resolver’s processes need to communicate on localhost. In case some firewall is in place please make sure that the traffic is allowed, i.e. <code class="docutils literal notranslate"><span class="pre">iptables</span> <span class="pre">-A</span> <span class="pre">INPUT</span> <span class="pre">-s</span> <span class="pre">127.0.0.1</span> <span class="pre">-j</span> <span class="pre">ACCEPT</span></code></p>
</div>
<div class="section" id="verifying-the-installation">
<h3>Verifying the installation<a class="headerlink" href="#verifying-the-installation" title="Permalink to this heading"></a></h3>
<p>Whalebone resolvers come with a set of testing domains for the verification of the installation and the Security filtering.
These domains can be used in order to ensure that you are effectively using a Whalebone resolver:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">http://malware.test.attacker.online</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">http://c2server.test.attacker.online</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">http://spam.test.attacker.online</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">http://phishing.test.attacker.online</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">http://coinminer.test.attacker.online</span></code></p></li>
</ul>
<p>Upon visiting these domains a blocking page similar to the following should be presented:</p>
<div class="figure align-center" id="id1">
<img alt="Blocking Pages (Default)" src="_images/blocking-page-default.png" />
<p class="caption"><span class="caption-text">Blocking Page - Whalebone Resolver is being used.</span><a class="headerlink" href="#id1" title="Permalink to this image"></a></p>
</div>
<p>In case you come across the page below, it means that the request was not blocked and thus a Whalebone resolver is not being used.
Please review your settings and if the issue persists, please contact support.</p>
<div class="figure align-center" id="id2">
<img alt="Blocking Pages (Target)" src="_images/testing-page.png" />
<p class="caption"><span class="caption-text">Blocking Page - Whalebone Resolver is not being used.</span><a class="headerlink" href="#id2" title="Permalink to this image"></a></p>
</div>
</div>
<div class="section" id="securing-your-resolver">
<h3>Securing your resolver<a class="headerlink" href="#securing-your-resolver" title="Permalink to this heading"></a></h3>
<p>Upon initial installation, the resolver is configured as an open resolver. It will respond to any request sent to it regardless of where the request originated from. This is quite
comfortable in terms of availability of the services, but could also be a risk if the service is available from the outside networks. Please make sure you limit the access
to the local resolver on port 53 (UDP and TCP) from the trusted networks only, otherwise it can be misused for various DoS attacks.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="quickstart.html" class="btn btn-neutral float-left" title="Quickstart" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="resolvers.html" class="btn btn-neutral float-right" title="Resolver management" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Whalebone, s.r.o..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>